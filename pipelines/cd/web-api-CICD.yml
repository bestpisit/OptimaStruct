steps:
  - task: DockerInstaller@0
    displayName: Install Docker 17.09.0-ce
  - task: PowerShell@2
    displayName: Docker login to ACR
    inputs:
      targetType: inline
      script: docker login $(loginserver) -u $(username) -p $(password)
  - task: PowerShell@2
    displayName: Docker Build API
    inputs:
      targetType: inline
      script: docker build -t api .
      workingDirectory: $(Pipeline.Workspace)/web/api
  - task: PowerShell@2
    displayName: Docker Tag API
    inputs:
      targetType: inline
      script: docker tag api $(loginserver)/api:latest
      workingDirectory: $(Pipeline.Workspace)/web/api
  - task: PowerShell@2
    displayName: Docker Push API
    inputs:
      targetType: inline
      script: docker push $(loginserver)/api:latest
      workingDirectory: $(Pipeline.Workspace)/web/api
