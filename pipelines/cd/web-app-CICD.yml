steps:
  - checkout: self
    clean: true
    fetchTags: false
  - task: DockerInstaller@0
    displayName: Install Docker 17.09.0-ce
  - task: PowerShell@2
    displayName: Docker login to ACR
    inputs:
      targetType: inline
      script: docker login __loginserver__ -u __username__ -p __password__
  - task: PowerShell@2
    displayName: Docker Build APP
    inputs:
      targetType: inline
      script: docker build -t app .
      workingDirectory: web/app
  - task: PowerShell@2
    displayName: Docker Tag API
    inputs:
      targetType: inline
      script: docker tag app __loginserver__/app:latest
      workingDirectory: web/app
  - task: PowerShell@2
    displayName: Docker Push API
    inputs:
      targetType: inline
      script: docker push __loginserver__/app:latest
      workingDirectory: web/app
